#!/bin/sh

#        _ _____  _____
#       | |  __ \|_   _|
#       | | |__| | | |
#   _   | |  _  /  | |
#  | |__| | | \ \ _| |_
#   \____/|_|  \_\_____|
#
# This yadm bootstrap file is launch when yadm will clone the dotfile project.
#
# The aim of this script is to perform the installation of all my dot files and so all my environment.

dir_build=~/perso
mkdir -p ${dir_build}
mkdir -p ~/download/

cd ${dir_build} || {
	echo "ERROR creating repository to get sources"
	exit 1
}

# ---------------------------------------------------------------------------------------------------------------------
# Global installations
# ---------------------------------------------------------------------------------------------------------------------
sudo apt install -y \
	autoconf \
	automake \
	pkg-config \
	curl \
	ninja-build \
	gettext \
	cmake \
	unzip \
	make \
	gcc \
	g++ \
	python3.10-venv \
	exa

# ---------------------------------------------------------------------------------------------------------------------
# Install npm
# ---------------------------------------------------------------------------------------------------------------------
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install nodejs -y

# ---------------------------------------------------------------------------------------------------------------------
# Install nvm
# ---------------------------------------------------------------------------------------------------------------------
curl -sL https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.0/install.sh -o ~/download/install_nvm.sh
bash ~/download/install_nvm.sh

# ---------------------------------------------------------------------------------------------------------------------
# tmux installation
# ---------------------------------------------------------------------------------------------------------------------
# https://github.com/tmux/tmux
git clone https://github.com/tmux/tmux.git
if cd tmux; then
	sh autogen.sh
	./configure
	make && make install
fi

# ---------------------------------------------------------------------------------------------------------------------
# fzf installation
# ---------------------------------------------------------------------------------------------------------------------
git clone --depth 1 https://github.com/junegunn/fzf.git "${dir_build}"/fzf
if cd ${dir_build}/fzf; then
	./install
fi

# ---------------------------------------------------------------------------------------------------------------------
# Install rust tools
# ---------------------------------------------------------------------------------------------------------------------
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh

# ---------------------------------------------------------------------------------------------------------------------
# Install fd
# ---------------------------------------------------------------------------------------------------------------------
cargo install fd-find

# ---------------------------------------------------------------------------------------------------------------------
# Install rg
# ---------------------------------------------------------------------------------------------------------------------
cargo install ripgrep

# ---------------------------------------------------------------------------------------------------------------------
# zoxide installation
# ---------------------------------------------------------------------------------------------------------------------
curl -sS https://raw.githubusercontent.com/ajeetdsouza/zoxide/main/install.sh | bash

# ---------------------------------------------------------------------------------------------------------------------
# starship installation
# ---------------------------------------------------------------------------------------------------------------------
# curl -sS https://starship.rs/install.sh | sh
curl https://starship.rs/install.sh -o ~/download/install.sh
sh ~/download/install.sh --yes

# ---------------------------------------------------------------------------------------------------------------------
# neovim installation
# ---------------------------------------------------------------------------------------------------------------------
git clone https://github.com/neovim/neovim "${dir_build}"/neovim
if cd ${dir_build}/neovim; then
	git checkout stable
	make CMAKE_BUILD_TYPE=RelWithDebInfo
	sudo make install
fi
